<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="roomMapper">

	<resultMap type="Room" id="roomResultSet">
        <id property="roomNo" column="ROOM_NO"/>
        <result property="memberNo" column="ROOM_MEMBER_NO"/>
        <result property="memberId" column="MEMBER_ID"/>
        <result property="roomTitle" column="ROOM_TITLE"/>
        <result property="roomContent" column="ROOM_CONTENT"/>
        <result property="roomPassword" column="ROOM_PWD"/>
        <result property="roomType" column="ROOM_TYPE"/>
        <result property="roomTypeName" column="ROOM_TYPE_NAME"/>
        <result property="roomCreateDate" column="ROOM_CREATE_DATE"/>
        <result property="roomModifyDate" column="ROOM_MODIFY_DATE"/>
        <result property="roomOpen" column="ROOM_OPEN"/>
        <result property="memberNick" column="MEMBER_NICK"/>
        <result property="roomTag" column="ROOM_TAG"/>
        <result property="roomMaxNumber" column="ROOM_MAX_NUMBER"/>
        
        
    </resultMap>
    <!-- room 정보 조회 쿼리 -->
	<select id="roomdetailInfo" parameterType="_int" resultMap="roomResultSet">
		SELECT ROOM_NO, ROOM_TITLE, ROOM_CONTENT, ROOM_CREATE_DATE, ROOM_STATUS, MEMBER_NO, MEMBER_ID, ROOM_TYPE_NAME, ROOM_OPEN
		FROM STUDY_ROOM 
		JOIN MEMBER ON (ROOM_MEMBER_NO = MEMBER_NO)
		JOIN STUDY_ROOM_CATEGORY ON (ROOM_TYPE = ROOM_CATEGORY_NO)
		WHERE ROOM_NO = #{roomNo}
	</select>
	
	<!-- room 패스워드 조회 쿼리 -->
	<select id="roomdetailInfoPwd" parameterType="_int" resultType="string">
		SELECT ROOM_PWD
		FROM STUDY_ROOM 
		WHERE ROOM_NO = #{roomNo}
		AND ROOM_OPEN = 'N'
		AND ROOM_STATUS = 'Y'
	</select>
	
	<!-- 즐겨찾기 리스트 조회 쿼리 -->
	<select id="roomMemberChk" parameterType="map" resultType="_int">
		SELECT COUNT(*)
		FROM ROOM_MEMBER
		WHERE ROOM_MEMBER_ROOM_NO = #{roomNo}
		AND ROOM_MEMBER_MEMBER_NO = #{memberNo}
	</select>
	
	<!-- 즐겨찾기 리스트 삽입 쿼리 -->
	<insert id="insertRoomMember" parameterType="map">
		INSERT INTO ROOM_MEMBER VALUES(#{roomNo}, #{memberNo}, 'G', NULL)
	</insert>
	
	<!-- 페이징 처리용 조회 쿼리-->
	<select id="getListCount" parameterType="_int" resultType="_int">
		SELECT COUNT(*)
		FROM STUDY_ROOM
	</select>
	
	<!-- 방 리스트 조회 쿼리 -->
	<select id="selectList" parameterType="_int" resultMap="roomResultSet">
		SELECT ROOM_NO,ROOM_TYPE,ROOM_TITLE,MEMBER_NICK,ROOM_CREATE_DATE,ROOM_TAG,ROOM_OPEN 
        FROM STUDY_ROOM
		JOIN MEMBER ON(ROOM_MEMBER_NO=MEMBER_NO)
        ORDER BY ROOM_NO DESC
	</select>
	
	<!-- 방 입장용 조회 쿼리 -->
	<select id="enterRoom" parameterType="Room" resultMap="roomResultSet">
		SELECT ROOM_PWD FROM STUDY_ROOM
		WHERE ROOM_NO= #{roomNo}
		AND ROOM_STATUS = 'Y'
	</select>
	
	<insert id="createRoom"  parameterType="Room" >
		INSERT INTO STUDY_ROOM VALUES (SEQ_ROOM.NEXTVAL, #{memberNo}, #{roomTitle}, #{roomContent}, #{roomPassword}
		,#{roomType}, DEFAULT,DEFAULT, #{roomOpen},#{roomOpen}, #{roomTag}, #{roomMaxNumber})
	</insert>
	
</mapper>
